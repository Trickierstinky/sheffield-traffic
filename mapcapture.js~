var intervalLength = 300000;

function screenCap() {
	loadMap();
	// loadRadar();
}

function loadMap() {
	var page = require('webpage').create();

	page.viewportSize = {
	  width: 1200,
	  height: 1200
	};

	page.open('https://www.google.com/maps/@53.381261,-1.4422942,12z/data=!5m1!1e1', function(success) {
		var timestamp = (new Date()).toLocaleString();

		console.log(success, timestamp);
		if(success) {
			map_wait(timestamp);
		}
	});

	function map_wait(timestamp) {
		setTimeout(function() {
			page.render('screengrabs/map-' + timestamp + '.png');
		}, 5000);
	}
}

function generate_traffic_gif() {
	var GIFEncoder = require('gifencoder');
	var encoder = new GIFEncoder(705, 528);
	var pngFileStream = require('png-file-stream');

	pngFileStream('screengrabs/map-?.png')
  .pipe(encoder.createWriteStream({ repeat: -1, delay: 30, quality: 10 }))
  .pipe(fs.createWriteStream('myanimated.gif')));

}

screenCap();
var interval = setInterval(screenCap, intervalLength);
